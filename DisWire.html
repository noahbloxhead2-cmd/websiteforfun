<html>
  <head>
    <style>
      body,
      html {
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: #0d0d16;
        font-family: "Inter", sans-serif;
      }

      /* Sidebar */
      #sidebar {
        display: flex;
        flex-direction: column;
        background: rgba(40, 40, 90, 0.4);
        backdrop-filter: blur(10px);
        width: 22vw;
        height: 90vh;
        position: fixed;
        left: 20px;
        top: 20px;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      }

      #authPanel {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 999999;
      }

      #authBox button {
        padding: 10px 20px;
        background-color: rgb(6, 6, 70);
        border-style: solid;
        border-color: rgb(80, 80, 160);
        border-radius: 10px;
        color: white;
        font-family: monospace;
        font-size: 18px;
        cursor: pointer;
        transition: 0.2s;
      }

      #authBox button:hover {
        filter: brightness(1.4);
      }
      #authBox input {
        padding: 10px 20px;
        background-color: rgb(6, 6, 70);
        border-style: solid;
        border-color: rgb(80, 80, 160);
        border-radius: 10px;
        color: white;
        font-family: monospace;
        font-size: 18px;
        cursor: text;
        transition: 0.2s;
      }
      #authBox input:hover {
        filter: brightness(1.4);
      }

      #authTitle {
        color: white;
        font-family: monospace;
      }

      #userdisplay {
        color: white;
        user-select: none;
        font-size: 28px;
        text-align: center;
        margin-bottom: 20px;
      }

      #changeuserbtn {
        padding: 12px;
        border-radius: 12px;
        background: #4a4ad1;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 18px;
        transition: 0.2s;
      }

      #changeuserbtn:hover {
        background: #6a6aff;
      }

      /* Chat area */
      #uppermessages {
        position: fixed;
        right: 20px;
        top: 20px;
        width: 70vw;
        height: 70vh;
        background: rgba(20, 20, 40, 0.6);
        backdrop-filter: blur(8px);
        border-radius: 16px;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      }

      /* Message bubble */
      .msgdiv {
        background: #1c1c2e;
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 60%;
        color: white;
        transition: 0.2s;
      }

      .msgdiv:hover {
        background: #2a2a45;
      }

      /* Input bar */
      #messagebar {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 60vw;
        height: 60px;
        background: #141428;
        border-radius: 12px;
        border: none;
        padding: 15px;
        color: white;
        font-size: 18px;
        resize: none;
        outline: none;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
        transition: 1s;
      }
      #messagebar:hover {
        filter: brightness(2);
      }

      /* Send button */
      #sendbutton {
        position: fixed;
        bottom: 30px;
        right: 40px;
        padding: 14px 24px;
        background: rgba(74, 74, 209, 0.5);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
        color: white;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-size: 18px;
        transition: 0.2s;
        width: 10vw;
        height: 60px;
      }

      #sendbutton:hover {
        background: #6a6aff;
      }

      /* Disclaimer */
      #Disclaimer {
        position: fixed;
        bottom: 5px;
        left: 20px;
        color: #888;
        font-size: 12px;
        user-select: none;
      }
    </style>
  </head>

  <body>
    <title>Random</title>

    <div id="sidebar">
      <h1 id="userdisplay">unknown</h1>
      <button id="changeuserbtn">change user</button>
    </div>

    <textarea id="messagebar" placeholder="message here..."></textarea>

    <div id="uppermessages"></div>

    <button id="sendbutton">Send</button>

    <h1 id="Disclaimer">Disclaimer: Not an online chatting service</h1>

    <!-- AUTH PANEL -->
    <div id="authPanel">
      <div id="authBox">
        <h1 id="authTitle">Login</h1>
        <input id="authUser" placeholder="username" />
        <button id="authSubmit">Submit</button>
        <br>
        <br>
        <input id="authPass" type="password" placeholder="password" />
        <button id="authCancel">Cancel</button>
        <br>
        <br>
        <button id="authSwitch">Create Account Instead</button>
      </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

    <script>
      let textbox = document.getElementById("messagebar");
      let sendbtn = document.getElementById("sendbutton");
      let messages = document.getElementById("uppermessages");
      let namebtn = document.getElementById("changeuserbtn");
      let userdisplay = document.getElementById("userdisplay");
      let username = "unknown";

      const firebaseConfig = {
        apiKey: "AIzaSyDx_P6m-wW68dfFfH3Yn8S6H3lXlNDg62g",
        authDomain: "project1-bad96.firebaseapp.com",
        projectId: "project1-bad96",
        storageBucket: "project1-bad96.firebasestorage.app",
        messagingSenderId: "1061798946964",
        appId: "1:1061798946964:web:6d5e24253b4146af522c81",
        measurementId: "G-E6S5VB594P",
        databaseURL: "https://project1-bad96-default-rtdb.firebaseio.com/",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const auth = firebase.auth();
      const messageRef = db.ref("Messages");

      /* ---------------- AUTH PANEL ---------------- */

      let authMode = "login";

      const authPanel = document.getElementById("authPanel");
      const authTitle = document.getElementById("authTitle");
      const authUser = document.getElementById("authUser");
      const authPass = document.getElementById("authPass");
      const authSubmit = document.getElementById("authSubmit");
      const authSwitch = document.getElementById("authSwitch");

      namebtn.onclick = () => {
        authPanel.style.display = "flex";
      };

      authSwitch.onclick = () => {
        if (authMode === "login") {
          authMode = "create";
          authTitle.textContent = "Create Account";
          authSwitch.textContent = "Login Instead";
        } else {
          authMode = "login";
          authTitle.textContent = "Login";
          authSwitch.textContent = "Create Account Instead";
        }
      };

      authSubmit.onclick = () => {
        const user = authUser.value.trim();
        const pass = authPass.value.trim();
        if (!user || !pass) return alert("Fill everything");

        const fakeEmail = user + "@local.user";

        if (authMode === "create") {
          auth
            .createUserWithEmailAndPassword(fakeEmail, pass)
            .then(() => {
              username = user;
              authPanel.style.display = "none";
            })
            .catch((err) => alert(err.message));
        } else {
          auth
            .signInWithEmailAndPassword(fakeEmail, pass)
            .then(() => {
              username = user;
              authPanel.style.display = "none";
            })
            .catch((err) => alert(err.message));
        }
      };

      auth.onAuthStateChanged((user) => {
        if (user) {
          username = user.email.split("@")[0];
        }
      });

      document.getElementById("authCancel").onclick = () => {
        authPanel.style.display = "none";
      };

      /* ---------------- CHAT SYSTEM ---------------- */

      messageRef.on("child_added", (snap) => {
        const key = snap.key;
        const data = snap.val();
        createmessage(data.user, data.text, key);
      });

      sendbtn.onclick = () => {
        const text = textbox.value.trim();
        if (text !== "") addMessage(text);
        textbox.value = "";
        textbox.focus();
      };

      textbox.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendbtn.click();
        }
      });

      setInterval(() => {
        userdisplay.textContent = username;
      }, 100);

      function createmessage(user, text, key) {
        const newmessage = document.createElement("h1");
        newmessage.textContent = `${user}: ${text}`;
        newmessage.style.color = "white";

        const newmessagediv = document.createElement("div");
        newmessagediv.classList = "msgdiv";
        newmessagediv.dataset.key = key;

        newmessagediv.oncontextmenu = (event) => {
          event.preventDefault();
          if (user === username) {
            messageRef.child(key).remove();
            newmessagediv.remove();
          }
        };

        newmessagediv.appendChild(newmessage);
        messages.appendChild(newmessagediv);
        messages.scrollTop = messages.scrollHeight;
      }

      function addMessage(text) {
        const newMessageRef = messageRef.push();
        newMessageRef.set({
          text: text,
          user: username,
        });
      }
    </script>
  </body>
</html>
